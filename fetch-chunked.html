<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fetch flowers</title>
</head>
<body>
<pre></pre>
<script>
    "use strict";
    let pre = document.querySelector("pre");
    fetch("https://jigsaw.w3.org/HTTP/ChunkedScript")
        .then(response => {
            return (function readChunk(reader, decoder) {
                return reader.read()
                    .then(function (result) {
                        let chunk = decoder.decode(result.value || new Uint8Array, {stream: !result.done});
                        console.log(chunk.length);
                        pre.insertAdjacentText("beforeend",chunk);
                        if (!result.done) {
                            return readChunk(reader, decoder);
                        }
                    });
            })(response.body.getReader(), new TextDecoder());
        })
        .catch(function (err) {
            console.error(err);
        });
</script>
</body>
</html>